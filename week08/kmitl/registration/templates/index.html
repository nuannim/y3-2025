{% extends "layout.html" %}

{% load static %}
{% load custom_filter %}
<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> -->
      {% block title %}
        Student Dashboard
      {% endblock %}
    <!-- </title> -->

    {% block head %}
    <script src="https://cdn.tailwindcss.com"></script>
    {% endblock %}
  <!-- </head> -->

  {% block content %}
  <!-- <body class="bg-white text-gray-800"> -->


    <!-- <main class="p-6 max-w-8xl mx-auto"> -->
      <section class="mb-6 flex sm:flex-row flex-col gap-4 justify-between">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-orange-500">Student Dashboard</h1>
            <p class="text-gray-500">
              Total <span class="font-medium text-blue-500">{{total}}</span> Students
            </p>
            <a href="{% url 'createstudent' %}">
              <button class="px-5 py-2 rounded-lg bg-orange-500 text-white hover:bg-orange-600">
                Create Student
              </button>
            </a>
          </div>
        </div>
        <section aria-label="Filter content" class="sm:self-end sm:place-items-end flex flex-col gap-y-2">
          <label class="text-2xl font-medium" for="search">Quick Search</label>
          <div class="flex flex-row gap-x-4 flex-wrap sm:justify-end" aria-label="Advanced Filters">
            <div aria-label="Full name">
              {% if filter == '' or filter == None %}
                <input class="cursor-pointer" type="radio" id="fullname" name="a_filter" value="" checked />
              {% else %}
                <input class="cursor-pointer" type="radio" id="fullname" name="a_filter" value="" />
              {% endif %}
              <label class="cursor-pointer" for="fullname">Full Name</label>
            </div>
            <div aria-label="Email">
              {% if filter == 'email' %}
                <input class="cursor-pointer" type="radio" id="email" name="a_filter" value="email" checked />
              {% else %}
                <input class="cursor-pointer" type="radio" id="email" name="a_filter" value="email" />
              {% endif %}
              <label class="cursor-pointer" for="email">Email</label>
            </div>

            <div aria-label="Faculty">
              {% if filter == 'faculty' %}
                <input class="cursor-pointer" type="radio" id="faculty" name="a_filter" value="faculty" checked />
              {% else %}
                <input class="cursor-pointer" type="radio" id="faculty" name="a_filter" value="faculty" />
              {% endif %}
              <label class="cursor-pointer" for="faculty">Faculty</label>
            </div>
          </div>
          
          <input 
          class="block w-[300px] rounded-md field-sizing-content border-[1px] px-4 py-2" 
          id="search" 
          type="text" 
          placeholder="Search students..." 
          autocomplete="search" value="{{search}}" 
          title="Filter data" />
        </section>
      </section>

      <div class="overflow-x-auto bg-white rounded-lg shadow border border-orange-100">
        <table class="min-w-full divide-y divide-orange-100">
          <thead class="bg-orange-100 text-left text-sm font-semibold text-gray-700">
            <tr>
              <th class="px-4 py-3">Student ID</th>
              <th class="px-4 py-3">Full Name</th>
              <th class="px-4 py-3">Email</th>
              <th class="px-4 py-3">Phone nuber</th>
              <th class="px-4 py-3">Faculty</th>
              <th class="px-4 py-3">Registration Section</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100 text-sm">
            {% for student in student_list %}
              {% if forloop.counter|divisibleby:"2" %}
                <tr class="hover:bg-orange-50 transition bg-gray-100">
                  {% if student.enrolled_sections.count %}
                    <td class="px-4 py-3">{{ student.student_id }}</td>
                    <td class="px-4 py-3 font-medium">{{ student.get_full_name }}</td>
                    <td class="px-4 py-3">{{ student.studentprofile.email }}</td>
                    <td class="px-4 py-3">{{ student.studentprofile.phone_number|changePhoneNumber }}</td>
                    <td class="px-4 py-3">{{ student.faculty.name }}</td>
                    <td class="px-4 py-3">
                      {% for section in student.enrolled_sections.all|sortSectionByDayOfWeek|dictsort:'day_of_week_num' %}
                        {{ section.course.course_name }}
                        ({{ section.section_number }}) - {{ section.day_of_week}}
                        {{ section.start_time }}-{{ section.end_time}}<br />
                      {% endfor %}
                  {% else %}
                    <td class="px-4 py-3 text-red-600">{{ student.student_id }}</td>
                    <td class="px-4 py-3 font-medium text-red-600">{{ student.get_full_name }}</td>
                    <td class="px-4 py-3 text-red-600">{{ student.studentprofile.email }}</td>
                    <td class="px-4 py-3 text-red-600">{{ student.studentprofile.phone_number|changePhoneNumber }}</td>
                    <td class="px-4 py-3 text-red-600">{{ student.faculty.name }}</td>
                    <td class="px-4 py-3 text-red-600">
                      -
                  {% endif %}
                  </td>
                </tr>
              {% else %}
                <tr class="hover:bg-orange-50 transition">
                  {% if student.enrolled_sections.count %}
                    <td class="px-4 py-3">{{ student.student_id }}</td>
                    <td class="px-4 py-3 font-medium">{{ student.get_full_name }}</td>
                    <td class="px-4 py-3">{{ student.studentprofile.email }}</td>
                    <td class="px-4 py-3">{{ student.studentprofile.phone_number|changePhoneNumber }}</td>
                    <td class="px-4 py-3">{{ student.faculty.name }}</td>
                    <td class="px-4 py-3">
                      {% for section in student.enrolled_sections.all|sortSectionByDayOfWeek|dictsort:'day_of_week_num' %}
                        {{ section.course.course_name }}
                        ({{ section.section_number }}) - {{ section.day_of_week}}
                        {{ section.start_time }}-{{ section.end_time}}<br />
                      {% endfor %}
                  {% else %}
                    <td class="px-4 py-3 text-red-600">{{ student.student_id }}</td>
                    <td class="px-4 py-3 font-medium text-red-600">{{ student.get_full_name }}</td>
                    <td class="px-4 py-3 text-red-600">{{ student.studentprofile.email }}</td>
                    <td class="px-4 py-3 text-red-600">{{ student.studentprofile.phone_number|changePhoneNumber }}</td>
                    <td class="px-4 py-3 text-red-600">{{ student.faculty.name }}</td>
                    <td class="px-4 py-3 text-red-600">
                      -
                    {% endif %}
                  </td>
                </tr>
              {% endif %}
            {% empty %}
              <tr>
                <td colspan="4" class="text-center text-gray-400 px-4 py-6">No students found.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    <!-- </main> -->

    {% block script %}
    <script src="{% static 'index.js' %}"></script>
    {% endblock %}

  <!-- </body> -->
{% endblock %}
</html>
